<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Struts2-OGNL&amp;OGNL – Simoon</title> <meta name="description" content="Improving Java Skills"> <meta name="keywords" content="Java, Struts2, valueStack, OGNL, SSH框架"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://i.imgur.com/Ds6S7lJ.png"> <meta name="twitter:title" content="Struts2-OGNL&amp;OGNL"> <meta name="twitter:description" content="本篇介绍了Struts2中的valueStack及其应用、OGNL的访问方式以及表达式常见的使用方式($ % #)"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Struts2-OGNL&amp;OGNL"> <meta property="og:description" content="本篇介绍了Struts2中的valueStack及其应用、OGNL的访问方式以及表达式常见的使用方式($ % #)"> <meta property="og:url" content="http://127.0.0.1:4000//Struts2-valueStack&amp;OGNL/"> <meta property="og:site_name" content="Simoon"> <meta property="og:image" content="http://127.0.0.1:4000//assets/img/logo.png"> <link rel="canonical" href="http://127.0.0.1:4000//Struts2-valueStack&amp;OGNL/"> <link href="http://127.0.0.1:4000//feed.xml" type="application/atom+xml" rel="alternate" title="Simoon Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://127.0.0.1:4000//assets/css/main.css"> <!-- JS --> <script src="http://127.0.0.1:4000//assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://127.0.0.1:4000//assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://127.0.0.1:4000//assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://127.0.0.1:4000//assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://127.0.0.1:4000//assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000//favicon.png"> <link rel="shortcut icon" href="http://127.0.0.1:4000//favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://127.0.0.1:4000//assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <style type="text/css">.feature {background-image:url(http://i.imgur.com/Ds6S7lJ.png);}</style> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://127.0.0.1:4000//">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://127.0.0.1:4000//assets/img/logo.png" alt="Simoon photo" class="author-photo"> <h4>Simoon</h4> <p>Improving Java Skills</p> </li> <li><a href="http://127.0.0.1:4000//about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:susimoon@163.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://facebook.com//profile.php?id=100009049525926" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://github.com/susimoon" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://127.0.0.1:4000//posts/">All Posts</a></li> <li><a href="http://127.0.0.1:4000//tags/">All Tags</a></li> </ul> </li> <li><a href="http://127.0.0.1:4000//projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title feature "> <h1>Struts2-OGNL&amp;OGNL</h1> <h4>05 Feb 2017</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~6 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://127.0.0.1:4000//posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <hr> <blockquote> <p>valueStack valueStack的应用 OGNL的访问方式 OGNL表达式常见使用方式($ % #)</p> </blockquote> <h2 id="centervaluestackcenter"><center>valueStack</center></h2> <h3 id="valuestack">valueStack的概念</h3> <p>valueStack是值栈。</p> <p>1.从技术角度：valueStack就是一个接口（com.opensymphony.xwork2.util.ValueStack）<br> 2.从使用角度：valueStack就是一个容器</p> <p class="notice">1.ValueStack有一个实现类叫OgnlValueStack。<br> 2.每一个action都有一个ValueStack。<br> (一个请求，一个request，一个action，一个valueStack，valueStack生命周期就是request生命周期) <br> 3.valueStack中存储了当前action对象以及其它常用web对象。(request、session、application、parameters)<br> 4.Struts2框架将valueStack以“struts.valueStack”为名存储到request域中。</p> <p class="notice">ongl与valueStack的关系：<br> valueStack主要是将action数据携带到页面上，在页面上通过ognl表达式将valueStack中数据获取出来。</p> <h3 id="valuestack-1">valueStack结构</h3> <p>ValueStack中存在root属性 (CompoundRoot)和context属性（OgnlContext）<br> 　　• CompoundRoot 就是 ArrayList<br> 　　• OgnlContext 就是 Map</p> <p class="notice">list集合中存储的是action相关信息。从list中获取数据，可以不使用#号。 <br> map集合中存储的是相关映射信息，包含paramters,request,session,application,attr等。从map中获取数据，需要使用#。(其实在struts2中的map–context其实就是ognlContext)</p> <p class="notice">结论:<br> 1.ValueStack它有两部分List和Map。<br> 2.在Struts2中List就是root，Map就是ognlContext。 3.默认情况下，在Struts2中从valueStack获取数据就是从root中获取（即不加#）。<br> 4.在Struts2中valueStack内部有两部分Map(ognlContext)和List(root)，而在map中持有root。</p> <p><img src="http://ww4.sinaimg.cn/large/83e1667djw1f8ys7xu9wwj21hs0q0tcj.jpg" alt=""></p> <h3 id="valuestackactioncontext">ValueStack和ActionContext的关系</h3> <p>值栈对象valueStack是请求时创建的。<br> 创建ActionContext对象过程中，创建值栈对象valueStack。<br> 在ActionContext中持有了valueStack的引用。</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ActionContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">ActionContext</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ctx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getValueStack</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div> <h3 id="section">获取值栈对象</h3> <p>对于valueStack获取有两种方式:</p> <p>1.通过request获取</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ValueStack</span> <span class="n">vs</span><span class="o">=(</span><span class="n">ValueStack</span><span class="o">)</span> <span class="n">ServletActionContext</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">ServletActionContext</span><span class="o">.</span><span class="na">STRUTS_VALUESTACK_KEY</span><span class="o">);</span>
</code></pre></div> <p>2.通过ActionContext获取(推荐)</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ValueStack</span> <span class="n">vs</span><span class="o">=</span><span class="n">ActionContext</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getValueStack</span><span class="o">();</span>
</code></pre></div> <h3 id="root">向值栈保存数据(主要针对root)</h3> <p>主要有两个方法：</p> <p class="notice">1.push(Object obj) –&gt; 底层就是root.add(0,obj)，将数据存储到栈顶。<br> 2.set(String name, Object obj); –&gt; 底层是将数据封装到HashMap中，再将这个HashMap通过push存储。</p> <h3 id="jsp">在JSP中获取值栈的数据</h3> <p>root中数据不需要#，而context中数据需要#。</p> <p>• 获取root中的数据：</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code>1.如果栈顶是一个Map集合，获取时，可以直接通过Map集合的key来获取value。  
	`<span class="nt">&lt;s:property</span>  <span class="na">value=</span><span class="s">""</span><span class="nt">/&gt;</span>`  		
2.如果栈顶数据不是一个Map，没有key值，可以使用序号来获取。  
	`<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"[0]"</span><span class="nt">&gt;</span>`       从0的位置向下查找所有  
	`<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"[0].top"</span><span class="nt">&gt;</span>`   只查找0位置上的数据
</code></pre></div> <p>• 获取OgnlContext中数据:</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="mi">1</span><span class="o">.</span><span class="na">request</span><span class="err">数据</span>      <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">();</span> 
<span class="mi">2</span><span class="o">.</span><span class="na">session</span><span class="err">数据</span>      <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">();</span>
<span class="mi">3</span><span class="o">.</span><span class="na">application</span><span class="err">数据</span>  <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">();</span>
<span class="mi">4</span><span class="o">.</span><span class="na">attr</span>   		  <span class="err">依次从</span><span class="n">request</span><span class="err">、</span><span class="n">session</span><span class="err">、</span><span class="n">application</span><span class="err">中查找</span>
<span class="mi">5</span><span class="o">.</span><span class="na">parameters</span> 	  <span class="err">获取请求参数</span>
</code></pre></div> <p class="notice">注：Struts2包装后的数据，不是真正的数据。</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OgnlDemo2Action</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="c1">// 向valueStack中存储数据(root)</span>
		<span class="n">ValueStack</span> <span class="n">vs</span> <span class="o">=</span> <span class="n">ActionContext</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getValueStack</span><span class="o">();</span>
		
		<span class="n">vs</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"tom"</span><span class="o">);</span>
		<span class="n">vs</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s">"hello"</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">SUCCESS</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
	获取OgnlContext中数据<span class="nt">&lt;br&gt;</span>
	<span class="err">&lt;</span>%
		request.setAttribute("rname", "rvalue");
		session.setAttribute("sname", "svalue");
		application.setAttribute("aname", "avalue");
	%&gt;
	
	<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#request.rname"</span><span class="nt">/&gt;&lt;br&gt;</span>
	<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#session.sname"</span><span class="nt">/&gt;&lt;br&gt;</span>
	<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#application.aname"</span><span class="nt">/&gt;&lt;br&gt;</span>
	
	<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#attr.sname"</span><span class="nt">/&gt;&lt;br&gt;</span>
	<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#parameters.username[0]"</span><span class="nt">/&gt;</span><span class="c">&lt;!--地址栏输入参数?username=tom&amp;username=ann--&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div> <hr> <h2 id="centervaluestackcenter-1"><center>valueStack的应用</center></h2> <p>ValueStack主流应用:就是解决将action数据携带到jsp页面</p> <h3 id="actionjsp">action向jsp携带的数据类型</h3> <p><strong>1.信息（String类型数据）</strong></p> <p class="notice">1.fieldError 针对某一个字段错误信息(常用于表单校验)<br> 2.actionError 逻辑操作时普通错误信息，不针对某一个字段(例如登录失败)<br> 3.message 通用消息</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="o">.</span><span class="na">addFieldError</span><span class="o">(</span><span class="s">"msg"</span><span class="o">,</span> <span class="s">"字段错误信息"</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">addActionError</span><span class="o">(</span><span class="s">"Action全局错误信息"</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">addActionMessage</span><span class="o">(</span><span class="s">"Action的消息信息"</span><span class="o">);</span>
</code></pre></div> <p>在jsp中使用Struts2提供标签显示消息信息:</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:fielderror</span> <span class="na">fieldName=</span><span class="s">"msg"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;s:actionerror/&gt;</span>
<span class="nt">&lt;s:actionmessage/&gt;</span>
</code></pre></div> <p><strong>2.数据（复杂类型数据）</strong></p> <p>• 在action中存储数据:</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;();</span>
<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"a"</span><span class="o">));</span>
<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"b"</span><span class="o">));</span>
<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"c"</span><span class="o">));</span>

<span class="n">ValueStack</span> <span class="n">vs</span> <span class="o">=</span> <span class="n">ActionContext</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getValueStack</span><span class="o">();</span>
<span class="n">vs</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">users</span><span class="o">);</span>
<span class="c1">//vs.set("users", users);</span>
</code></pre></div> <p>• 在页面上获取数据:</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code>1.使用push存储数据，可用[0].top获取：
<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"[0].top.users"</span> <span class="nt">/&gt;</span>

2.使用set存储数据，直接使用key获取：
<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users"</span> <span class="nt">/&gt;</span>

3.取出集合中每个元素时，使用iterator：

将集合中迭代出来每一个元素起个名称叫user，var内容是存储在context中，需要使用#。
<span class="nt">&lt;s:iterator</span> <span class="na">value=</span><span class="s">"[0].top"</span> <span class="na">var=</span><span class="s">"user"</span><span class="nt">&gt;</span>
	username:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#user.username"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/s:iterator&gt;</span>

没有给迭代出的元素起名，则不需要使用#。
<span class="nt">&lt;s:iterator</span> <span class="na">value=</span><span class="s">"[0].top"</span><span class="nt">&gt;</span>
	username:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/s:iterator&gt;</span>
</code></pre></div> <h3 id="valuestack-2">默认压入到valueStack中的数据</h3> <p><strong>1.访问的action对象会被压入到valueStack中</strong>（类似属性驱动）</p> <p>(源码)DefaultActionInvocation的init方法中有stack.push(action); Action如果想传递数据给JSP，只有将数据保存到成员变量，并且提供get方法就可以了。 (获取时直接使用get后面的名字)</p> <p><strong>2.ModelDriveInterceptor会执行下面的操作</strong>（类似模型驱动）</p> <p>将实现了ModelDrive接口的action中getModel方法的返回值即model对象压入到了valueStack。</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">//(源码)</span>
<span class="n">ModelDriven</span> <span class="n">modelDriven</span> <span class="o">=</span> <span class="o">(</span><span class="n">ModelDriven</span><span class="o">)</span> <span class="n">action</span><span class="o">;</span>
<span class="n">ValueStack</span> <span class="n">stack</span> <span class="o">=</span> <span class="n">invocation</span><span class="o">.</span><span class="na">getStack</span><span class="o">();</span>
<span class="n">Object</span> <span class="n">model</span> <span class="o">=</span> <span class="n">modelDriven</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">model</span> <span class="o">!=</span>  <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">stack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div> <p><strong>压入到valueStack中的model分析：</strong></p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"User [username="</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="kd">implements</span> <span class="n">ModelDriven</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;{</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"tom"</span><span class="o">);</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getModel</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <p><img src="http://wx2.sinaimg.cn/large/83e1667dgy1fceng821xzj20ty0lsgos.jpg" alt=""></p> <p class="notice">1.Struts2中所有拦截器执行前会先把访问的action对象压入到valueStack中。(图中cn.xsw.test.Test) <br> 2.ModelDriveInterceptor使getModel中的model压入到valueStack中。(图中栈顶cn.xsw.test.User)</p> <p>当在execute方法中又新建一个User对象时：</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="kd">implements</span> <span class="n">ModelDriven</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;{</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"tom"</span><span class="o">);</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getModel</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <p><img src="http://wx2.sinaimg.cn/large/83e1667dgy1fceng9fio2j20u80lktbx.jpg" alt=""></p> <p class="notice">1.action先入栈。此时user指向的是tom。<br> 2.ModelDriven拦截器会将getModel方法返回值对象压栈，也就是将返回的user压入栈中，此时指向的是tom。 3.当action的execute方法执行时，对user重新赋值，跳到成功页面，此时user指向了John，但modelDriven中的指向不变。<br> 4.debug方法又调用了getModel方法，返回execute中的的user，因为execute方法已经执行了，user重新初始化。返回的是John。<br> 5.总结：action中的user会变，modelDriven中的user不会变。</p> <hr> <h2 id="centervaluestackcenter-2"><center>valueStack相关的结构信息总结</center></h2> <p><img src="http://ww2.sinaimg.cn/large/83e1667djw1f8ztg8g2pvj21la0tm45q.jpg" alt=""></p> <p class="notice">注：图中context指向的是ognlContext整体。</p> <hr> <h2 id="centerelvaluestackcenter"><center>EL表达式可以访问valueStack中数据</center></h2> <p class="notice">Struts2框架中所使用的request对象，是增强后的request对象。<br> ${username} –&gt; request.getAttribute(“username”);<br> 增强后的request，会首先在request域范围查找；如果查找不到，会在valueStack中查找request对象。</p> <p>StrutsPreparedAndExecuteFilter的doFilter代码中：request = prepare.wrapRequest(request);<br> 1.对Request对象进行了包装，StrutsRequestWrapper <br> 2.重写request的getAttribute：</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">attribute</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
	   <span class="n">attribute</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="na">findValue</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
	1.OGNL获取:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"username"</span><span class="nt">/&gt;&lt;br&gt;</span>
	2.EL获取:${username}	
<span class="nt">&lt;/body&gt;</span>
</code></pre></div> <hr> <hr> <h2 id="centerognlcenter"><center>OGNL</center></h2> <p>OGNL是Object Graphic Navigation Language(对象图导航语言)的缩写，它是一个开源项目。 <br> Struts2框架使用OGNL作为默认的表达式语言，需要导入jar包： <code class="highlighter-rouge">xwork提供OGNL表达式</code> <br> <code class="highlighter-rouge">ognl-3.0.5.jar</code></p> <p><strong>OGNL提供五大类功能:</strong></p> <p class="notice">1.支持对象方法调用，如xxx.doSomeSpecial()； <br> 2.支持类静态的方法调用和值访问<br> 3.访问OGNL上下文（OGNL context）和ActionContext；(重点 操作ValueStack值栈)<br> 4.支持赋值操作和表达式串联<br> 5.操作集合对象</p> <hr> <h2 id="centerognlcenter-1"><center>OGNL的访问方式</center></h2> <h3 id="action">访问值栈中的action的普通属性</h3> <p>直接访问值栈中的属性即可。</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
</code></pre></div> <h3 id="action-1">访问值栈中action的普通方法</h3> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">printUsername</span><span class="o">()</span> <span class="o">{</span> <span class="c1">//普通方法</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"printUsername()"</span><span class="nt">/&gt;</span>
</code></pre></div> <hr> <h3 id="getset">访问值栈中对象的普通属性(get、set方法)</h3> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"tom"</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"user constructor"</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"user.username"</span><span class="nt">/&gt;</span>
</code></pre></div> <p><strong>结果：</strong>在值栈中user的值为空，即对象user没有初始化。</p> <p><strong>解决方式：</strong><br> 1.传入参数user.username=tom后，Struts2才会new这个对象。 <br> 2.在action中直接new一个对象，即<code class="highlighter-rouge">private User user = new User();</code></p> <p class="notice">注：当User类没有空参构造，而又传入参数user.username=tom时，user依然是空值。<br> 因为User类没有空参构造方法，并没有成功构造一个user对象。</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">//错误方式</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"tom"</span><span class="o">;</span>
	
<span class="c1">//	public User() {</span>
<span class="c1">//		System.out.println("user constructor");</span>
<span class="c1">//	}</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <p class="notice">结论：想初始化domain model，可以自己new也可以传参数值，但需要有空的构造方法。</p> <h3 id="section-1">访问值栈中对象的普通方法和属性</h3> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"user.username.length()"</span><span class="nt">/&gt;</span>
</code></pre></div> <hr> <h3 id="section-2">访问静态方法和属性</h3> <p>访问静态方法：@类名@方法名<br> 访问静态方法：@类名@属性名</p> <p>需要在struts.xml中设置才可以访问静态方法 <code class="highlighter-rouge">&lt;constant name="struts.ognl.allowStaticMethodAccess" value="true"&gt;&lt;/constant&gt;</code></p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">STR</span> <span class="o">=</span> <span class="s">"STATIC STRING"</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">out</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Static Method"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"@cn.xsw.test.Test@out()"</span><span class="nt">/&gt;&lt;br/&gt;</span>
 <span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"@cn.xsw.test.Test@STR"</span><span class="nt">/&gt;&lt;br/&gt;</span>
</code></pre></div> <hr> <h3 id="section-3">访问普通类的构造方法</h3> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"User [username="</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"new cn.xsw.test.User('tom')"</span><span class="nt">/&gt;</span>  

result:User [username=tom]
</code></pre></div> <hr> <h3 id="section-4">访问集合</h3> <p><strong>1.List</strong></p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"User [username="</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;();</span>
	
	<span class="kd">public</span> <span class="nf">Test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"a"</span><span class="o">));</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"b"</span><span class="o">));</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"c"</span><span class="o">));</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUsers</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">users</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">users</span> <span class="o">=</span> <span class="n">users</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code>1.访问List：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users"</span><span class="nt">/&gt;</span>
result:[User [username=a], User [username=b], User [username=c]]

2.访问List中某个元素：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users[0]"</span><span class="nt">/&gt;</span>
result:User [username=a]

3.访问List中元素某个属性的集合：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{username}"</span><span class="nt">/&gt;</span>
result:[a, b, c](User类一定要有get方法，否则无法访问)

4.访问List中元素某个集合的特定值<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users[0].username"</span><span class="nt">/&gt;</span>|
<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{username}[0]"</span><span class="nt">/&gt;</span>
result:[a]
</code></pre></div> <p><strong>2.Set</strong></p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"User [username="</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;();</span>
	
	<span class="kd">public</span> <span class="nf">Test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"a"</span><span class="o">));</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"b"</span><span class="o">));</span>
		<span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"c"</span><span class="o">));</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUsers</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">users</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsers</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">users</span> <span class="o">=</span> <span class="n">users</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code>1.访问Set:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users"</span><span class="nt">/&gt;</span>
result:[User [username=a], User [username=c], User [username=b]]

2.访问Set中某个元素:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users[0]"</span><span class="nt">/&gt;</span>
result:set无序，取不到该元素
</code></pre></div> <p><strong>3.Map</strong></p> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"User [username="</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="n">userMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;();</span>
	
	<span class="kd">public</span> <span class="nf">Test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">userMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"a"</span><span class="o">));</span>
		<span class="n">userMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"b"</span><span class="o">));</span>
		<span class="n">userMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"c"</span><span class="o">,</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"c"</span><span class="o">));</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUserMap</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userMap</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="n">userMap</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userMap</span> <span class="o">=</span> <span class="n">userMap</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <div class="language-html highlighter-rouge"><pre class="highlight"><code>1.访问Map:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap"</span><span class="nt">/&gt;</span>
result:{b=User [username=b], c=User [username=c], a=User [username=a]}

2.访问Map中某个元素:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap.a"</span><span class="nt">/&gt;</span> | 
<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap['a']"</span><span class="nt">/&gt;</span> | <span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap[\"</span><span class="na">a</span><span class="err">\"]"</span><span class="nt">/&gt;</span>
result:User [username=a]

3.访问Map中所有的key:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap.keys"</span><span class="nt">/&gt;</span>
result:[b, c, a]

4.访问Map中所有的value:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap.values"</span><span class="nt">/&gt;</span>
result:[User [username=b], User [username=c], User [username=a]]

5.<span class="nt">&lt;li&gt;</span>访问容器的大小：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap.size()"</span><span class="nt">/&gt;</span> | <span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"userMap.size"</span><span class="nt">/&gt;</span>
result:3
</code></pre></div> <hr> <h3 id="section-5">访问投影(过滤器)</h3> <p class="notice">this指循环过程中的当前对象<br> ?# 过滤条件<br> ^# 开头<br> $# 结尾</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code>投影：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{?#this.age==1}[0]"</span><span class="nt">/&gt;</span> 
投影：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{^#this.age&gt;1}.{age}"</span><span class="nt">/&gt;</span>
投影：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{$#this.age&gt;1}.{age}"</span><span class="nt">/&gt;</span>
投影：<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"users.{$#this.age&gt;1}.{age} == null"</span><span class="nt">/&gt;</span>
</code></pre></div> <hr> <h3 id="section-6">[]</h3> <div class="language-html highlighter-rouge"><pre class="highlight"><code>[]:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"[0]"</span><span class="nt">/&gt;</span> 在Value Stack中从第0个开始一直访问到栈底
[]:<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"[1]"</span><span class="nt">/&gt;</span> 在Value Stack中从第1个开始一直访问到栈底
</code></pre></div> <hr> <h2 id="centerognl--center"><center>OGNL表达式常见使用方式($ % #)</center></h2> <h3 id="section-7">#号</h3> <p><strong>1.#代表ActionContext.getContext()</strong></p> <p><code class="highlighter-rouge">&lt;s:property value="#request.name"/&gt;</code>等同于<code class="highlighter-rouge">ActionContext().getContext().getRequest().get("name");</code> #request、#session、#application、#attr、#parameters同理。</p> <p><strong>2.进行投影映射</strong></p> <p><strong>3.使用#构造集合</strong></p> <p>经常结合struts2标签用来生成select、checkbox、radio。</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
	1.构建一个Map集合<span class="nt">&lt;br&gt;</span>
	<span class="nt">&lt;s:iterator</span> <span class="na">value=</span><span class="s">"#{'name':'tom','age':20}"</span> <span class="na">var=</span><span class="s">"entry"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#entry.key"</span> <span class="nt">/&gt;</span> -- <span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#entry.value"</span> <span class="nt">/&gt;&lt;br&gt;</span>	
	<span class="nt">&lt;/s:iterator&gt;</span>

	
	2.构建List集合<span class="nt">&lt;br&gt;</span>
	<span class="nt">&lt;s:iterator</span> <span class="na">value=</span><span class="s">"{'aa','bb','cc'}"</span> <span class="na">var=</span><span class="s">"v"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;s:property</span> <span class="na">value=</span><span class="s">"#v"</span> <span class="nt">/&gt;&lt;br&gt;</span>
	<span class="nt">&lt;/s:iterator&gt;</span>


	3.手动创建一个集合，在Struts2中结合表单标签使用<span class="nt">&lt;br&gt;</span>
	<span class="nt">&lt;s:form&gt;</span>
		<span class="nt">&lt;s:radio</span> <span class="na">list=</span><span class="s">"{'男','女'}"</span> <span class="na">name=</span><span class="s">"sex"</span><span class="nt">&gt;&lt;/s:radio&gt;</span>		
		<span class="nt">&lt;s:radio</span> <span class="na">list=</span><span class="s">"#{'男':'male','女':'female'}"</span> <span class="na">name=</span><span class="s">"sex"</span><span class="nt">&gt;&lt;/s:radio&gt;</span>
		<span class="nt">&lt;s:select</span> <span class="na">list=</span><span class="s">"{'a','b','c'}"</span> <span class="na">name=</span><span class="s">"aa"</span><span class="nt">&gt;&lt;/s:select&gt;</span>
		<span class="nt">&lt;s:select</span> <span class="na">list=</span><span class="s">"#{'a':'aaa','b':'bbb','c':'ccc'}"</span> <span class="na">name=</span><span class="s">"aa"</span><span class="nt">&gt;&lt;/s:select&gt;</span>
	<span class="nt">&lt;/s:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div> <h3 id="section-8">%号</h3> <p>作用:用于设定当前是否要解析其为ognl表达式。</p> <p class="notice">%{表达式} 当前表达式会被做为ognl解析<br> %{‘表达式’} 当前表达式不会被做为ognl解析</p> <p>特例:<code class="highlighter-rouge">&lt;s:property value="表达式"&gt;</code>，对于s:property标签，它的value属性会被默认做为ognl。<br> 所有表达式如果想要让其是ognl，则可统一写成%{表达式}的形式。</p> <h3 id="section-9">$号</h3> <p>作用:在配置文件中使用ognl表达式来获取valueStack中数据。</p> <p><strong>1.在struts.xml中使用</strong></p> <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;result</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>${contentType}<span class="nt">&lt;/param&gt;</span>
<span class="nt">&lt;/result&gt;</span>
</code></pre></div> <p><strong>2.在校验文件中使用</strong></p> <div class="language-xml highlighter-rouge"><pre class="highlight"><code>${min}  ${max}
${minLength} ${maxLength}
</code></pre></div> <p><strong>3.在国际化文件中使用</strong></p> <p>在properties文件中：(加%也可以，但配置文件一般用$)</p> <div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">username</span><span class="p">=</span><span class="s">${#request.username}</span>
<span class="py">username</span><span class="p">=</span><span class="s">{#request.username} # 会原样输出</span>
</code></pre></div> <p class="notice">总结: <br> #就是用于获取数据 <br> %就是用于设置是否是ognl表达式 <br> $就是在配置文件中使用ognl</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://127.0.0.1:4000//tags/#Java" title="Pages tagged Java" class="tag"><span class="term">Java</span></a><a href="http://127.0.0.1:4000//tags/#Struts2" title="Pages tagged Struts2" class="tag"><span class="term">Struts2</span></a><a href="http://127.0.0.1:4000//tags/#valueStack" title="Pages tagged valueStack" class="tag"><span class="term">valueStack</span></a><a href="http://127.0.0.1:4000//tags/#OGNL" title="Pages tagged OGNL" class="tag"><span class="term">OGNL</span></a><a href="http://127.0.0.1:4000//tags/#SSH%E6%A1%86%E6%9E%B6" title="Pages tagged SSH框架" class="tag"><span class="term">SSH框架</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000//Struts2-valueStack&amp;OGNL/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000//Struts2-valueStack&amp;OGNL/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://127.0.0.1:4000//Struts2-valueStack&amp;OGNL/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://127.0.0.1:4000//assets/js/jquery-1.12.0.min.js"></script> <script src="http://127.0.0.1:4000//assets/js/jquery.dlmenu.min.js"></script> <script src="http://127.0.0.1:4000//assets/js/jquery.goup.min.js"></script> <script src="http://127.0.0.1:4000//assets/js/jquery.magnific-popup.min.js"></script> <script src="http://127.0.0.1:4000//assets/js/jquery.fitvid.min.js"></script> <script src="http://127.0.0.1:4000//assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
